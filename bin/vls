#!/usr/bin/env ruby
#
# The vls command line utility script.
#

require_relative '../lib/vls'

def vls_show_header
  puts "vls (VersionLS): #{VersionLS::VERSION}"
  puts
end

def vls_show_help
  vls_show_header

  puts VersionLS::DESCRIPTION
  puts

  puts "Usage template:"
  puts "$ vls <options> <names>"
  puts " <names> are gems/files to be required before modules are listed."
  puts

  puts "Note:"
  puts " To specify a file instead of a gem, a '.rb' extension is required."
  exit
end

load_list = []
show_all = false
no_header = false

ARGV.each do |arg|
  case arg
  when "--help", "-h", "-?"
    vls_show_help
  when "--all", "-a"
    show_all = true
  when "--raw", "-r"
    no_header = true
  else
    load_list << arg
  end
end

vls_show_help   if     load_list.empty?
vls_show_header unless no_header

load_list.each do |pkg|
  begin
    if pkg.downcase.end_with?('.rb')
      require Dir.getwd + '/' + pkg
    else
      require pkg
    end
  rescue LoadError, StandardError => error
    puts "Error loading #{pkg}, #{error.message}"
  end
end

VersionLS.vls.each do |mod|
  puts "#{mod[0]}, #{mod[1]}"
end
